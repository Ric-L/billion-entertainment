name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy to server
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SSH_HOST }} # 185.199.52.20
          username: ${{ secrets.SSH_USERNAME }} # root
          key: ${{ secrets.SSH_PRIVATE_KEY }} # Your private key
          port: 22
          script: |
            set -e
            echo "ğŸš€ Starting deployment to server..."

            echo "ğŸ“ Changing to project directory..."
            cd /var/www/demo/billion-entertainment

            echo "ğŸ“¥ Pulling latest changes..."
            git pull origin main

            echo "ğŸ“¦ Installing dependencies..."
            npm install

            echo "ğŸ›‘ Stopping existing application..."
            pm2 delete billion-entertainment || echo "â„¹ï¸  No existing process found - continuing..."

            echo "ğŸ—ï¸ Building application..."
            npm run build

            echo "â–¶ï¸ Starting application with PM2..."
            pm2 start npm --name "billion-entertainment" -- start
            pm2 save

            echo "âœ… Deployment completed!"
            echo ""
            echo "ğŸ“Š === PM2 STATUS ==="
            pm2 status
            echo ""
            echo "ğŸ“‹ === PM2 LIST ==="
            pm2 list
            echo ""
            echo "ğŸ” === APPLICATION INFO ==="
            pm2 show billion-entertainment
